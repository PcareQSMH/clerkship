<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    /* --- Pastel Theme Variables --- */
    :root {
      --bg-color: #FDFBF7; /* Creamy White */
      --primary: #FFB7B2;  /* Pastel Red/Pink */
      --secondary: #A0E7E5; /* Pastel Mint */
      --accent: #B4F8C8;    /* Pastel Green */
      --text-main: #6E7C7C; /* Soft Gray */
      --text-light: #FFFFFF;
      --card-bg: #FFFFFF;
      --shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      --error: #ff8c94;
    }

    * { box-sizing: border-box; }
    body {
      font-family: 'Sarabun', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-main);
      margin: 0;
      padding: 0;
      line-height: 1.6;
    }

    /* Layout & Container */
    .container {
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
    }
    
    .card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 30px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
      border-top: 5px solid var(--secondary);
    }

    h1, h2, h3 { color: var(--text-main); text-align: center; }
    h1 { color: #ff9aa2; }

    /* Tabs */
    .nav-tabs {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
      gap: 10px;
    }
    .nav-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 30px;
      background: #e2f0cb;
      color: var(--text-main);
      cursor: pointer;
      font-weight: bold;
      transition: 0.3s;
    }
    .nav-btn.active {
      background: var(--secondary);
      color: white;
      box-shadow: 0 4px 10px rgba(160, 231, 229, 0.4);
    }

    /* Form Elements */
    .form-group { margin-bottom: 20px; }
    label { display: block; margin-bottom: 8px; font-weight: 500; }
    
    input, select {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #eee;
      border-radius: 12px;
      font-family: 'Sarabun', sans-serif;
      font-size: 16px;
      outline: none;
      transition: 0.3s;
      background: #fafafa;
    }
    input:focus, select:focus {
      border-color: var(--secondary);
      background: white;
    }
    
    .btn-submit {
      width: 100%;
      padding: 15px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
      margin-top: 10px;
    }
    .btn-submit:hover { background: #ff9aa2; transform: translateY(-2px); }
    .btn-submit:disabled { background: #ddd; cursor: not-allowed; }

    /* Video Link Button Style */
    .btn-video {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        padding: 15px;
        background: #fff0f0;
        color: #e17055;
        border: 2px solid #ffcccc;
        border-radius: 15px;
        text-decoration: none;
        font-weight: bold;
        transition: 0.3s;
        margin-top: 10px;
    }
    .btn-video:hover {
        background: #ffecec;
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(255, 118, 117, 0.2);
    }

    /* File Upload Styling */
    .file-input-wrapper {
      position: relative;
      overflow: hidden;
      display: inline-block;
      width: 100%;
    }
    input[type=file] {
      font-size: 14px;
    }

    /* Alerts */
    .alert {
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      display: none;
      text-align: center;
    }
    .alert-danger { background-color: #ffe5e5; color: #d63031; border: 1px solid #ffcccc; }
    .alert-success { background-color: #e3fcef; color: #00b894; border: 1px solid #b8eadd; }

    /* Dashboard Table */
    .table-responsive { overflow-x: auto; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      min-width: 600px; /* Force scroll on mobile */
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }
    th { background-color: #f0f0f0; color: #555; font-weight: 600; }
    
    .status-badge {
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
    }
    .status-pending { background: #ffeaa7; color: #e17055; }
    .status-done { background: var(--accent); color: #006266; }

    /* Hidden Sections */
    .section { display: none; }
    .section.active { display: block; animation: fadeIn 0.5s; }

    /* Loading Overlay */
    #loading {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(255,255,255,0.9);
      display: flex; justify-content: center; align-items: center;
      z-index: 999; display: none; flex-direction: column;
    }
    .spinner {
      border: 5px solid #f3f3f3; border-top: 5px solid var(--secondary);
      border-radius: 50%; width: 50px; height: 50px;
      animation: spin 1s linear infinite; margin-bottom: 10px;
    }

    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

  </style>
</head>
<body>

  <!-- Loading Screen -->
  <div id="loading">
    <div class="spinner"></div>
    <div style="color: var(--text-main); font-weight: bold;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...</div>
  </div>

  <div class="container">
    <div style="text-align: center; margin-bottom: 30px;">
      <h2 style="margin:0;">‡∏ù‡πà‡∏≤‡∏¢‡∏¢‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå</h2>
      <h3 style="margin:5px 0; font-weight: 400;">‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏™‡∏°‡πÄ‡∏î‡πá‡∏à‡∏û‡∏£‡∏∞‡∏ö‡∏£‡∏°‡∏£‡∏≤‡∏ä‡πÄ‡∏ó‡∏ß‡∏µ ‡∏ì ‡∏®‡∏£‡∏µ‡∏£‡∏≤‡∏ä‡∏≤</h3>
    </div>

    <!-- Tab Navigation -->
    <div class="nav-tabs">
      <button class="nav-btn active" onclick="switchTab('report')">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ï‡∏±‡∏ß‡∏ô‡∏¥‡∏™‡∏¥‡∏ï</button>
      <button class="nav-btn" onclick="switchTab('dashboard')">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£</button>
    </div>

    <!-- ================== PART 1: REPORTING ================== -->
    <div id="tab-report" class="section active">
      
      <!-- Step 1: Login -->
      <div id="step-login" class="card">
        <h3>üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h3>
        <p style="text-align: center; font-size: 14px; color: #888;">‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô 13 ‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ï‡∏±‡∏ß</p>
        <div class="form-group">
          <input type="number" id="login-id" placeholder="‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô 13 ‡∏´‡∏•‡∏±‡∏Å" oninput="if(this.value.length>13) this.value=this.value.slice(0,13)">
        </div>
        <button class="btn-submit" onclick="handleLogin()">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</button>
        <div id="login-error" class="alert alert-danger" style="margin-top: 10px;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 13 ‡∏´‡∏•‡∏±‡∏Å</div>
      </div>

      <!-- Step 2: Form -->
      <div id="step-form" class="card section">
        <h3>üìù ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ï‡∏±‡∏ß</h3>
        
        <!-- Cascading Dropdowns -->
        <div class="form-group">
          <label>‡∏õ‡∏µ ‡∏û.‡∏®.</label>
          <select id="sel-year" onchange="filterData('year')"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ ‡∏û.‡∏®.</option></select>
        </div>
        <div class="form-group">
          <label>‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ</label>
          <select id="sel-level" onchange="filterData('level')" disabled><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ</option></select>
        </div>
        <div class="form-group">
          <label>‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢</label>
          <select id="sel-uni" onchange="filterData('uni')" disabled><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢</option></select>
        </div>
        <div class="form-group">
          <label>‡∏™‡∏≤‡∏Ç‡∏≤</label>
          <select id="sel-major" onchange="filterData('major')" disabled><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤</option></select>
        </div>
        <div class="form-group">
          <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
          <select id="sel-name" onchange="displayPeriod()" disabled><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</option></select>
        </div>

        <!-- Auto Display Period -->
        <div class="form-group" style="background: #f0fdf4; padding: 15px; border-radius: 10px; border: 1px dashed #4ade80;">
          <label style="color: #166534;">üìÖ ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô:</label>
          <div id="display-period" style="font-weight: bold; color: #15803d;">-</div>
        </div>

        <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">

        <!-- Health Data -->
        <h4>üè• ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û (Chest X-ray & Vaccine)</h4>
        <div class="alert alert-danger" id="health-error">
          ‚õî ‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ï‡∏±‡∏ß: ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à Chest X-ray ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡πÑ‡∏Ç‡πâ‡∏´‡∏ß‡∏±‡∏î‡πÉ‡∏´‡∏ç‡πà ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 12 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô
        </div>

        <div class="form-group">
          <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à Chest X-ray (‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</label>
          <input type="date" id="date-xray">
        </div>
        <div class="form-group">
          <label>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô X-ray</label>
          <input type="file" id="file-xray" accept="image/*,.pdf">
        </div>

        <div class="form-group">
          <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏â‡∏µ‡∏î‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡πÑ‡∏Ç‡πâ‡∏´‡∏ß‡∏±‡∏î‡πÉ‡∏´‡∏ç‡πà (‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</label>
          <input type="date" id="date-vac">
        </div>
        <div class="form-group">
          <label>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô</label>
          <input type="file" id="file-vac" accept="image/*,.pdf">
        </div>

        <button class="btn-submit" onclick="submitData()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ï‡∏±‡∏ß</button>
      </div>

      <!-- Step 3: Success -->
      <div id="step-success" class="card section" style="text-align: center;">
        <div style="font-size: 50px;">üéâ</div>
        <h2 style="color: var(--secondary);">‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</h2>
        <p>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏á‡∏≤‡∏ô‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£‡∏£‡∏° ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏™‡∏°‡πÄ‡∏î‡πá‡∏à‡∏Ø ‡∏ì ‡∏®‡∏£‡∏µ‡∏£‡∏≤‡∏ä‡∏≤</p>
        
        <div style="text-align: left; background: #fafafa; padding: 20px; border-radius: 10px; margin: 20px 0;">
          <strong>üìå ‡∏Ç‡πâ‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏Å:</strong>
          <ul>
            <li>‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ‡∏ó‡∏µ‡πà 4 ‡∏≠‡πà‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡πÉ‡∏ô‡πÄ‡∏•‡πà‡∏°‡∏ù‡∏∂‡∏Å‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô</li>
            <li>‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ‡∏ó‡∏µ‡πà 6 ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡∏ù‡∏∂‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡πÄ‡∏ô‡πâ‡∏ô</li>
            <li>‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏≤‡∏¢‡∏ä‡∏∏‡∏î‡∏ô‡∏¥‡∏™‡∏¥‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡πÉ‡∏™‡πà‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡∏´‡∏∏‡πâ‡∏°‡∏™‡πâ‡∏ô‡∏™‡∏µ‡∏™‡∏∏‡∏†‡∏≤‡∏û</li>
            <li>‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô ‡∏ô‡∏±‡∏î‡∏û‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏®‡∏£‡∏µ‡∏™‡∏ß‡∏£‡∏¥‡∏ô‡∏ó‡∏¥‡∏£‡∏≤‡∏ô‡∏∏‡∏™‡∏£‡∏ì‡πå ‡πë‡πï‡πê ‡∏õ‡∏µ</li>
            <li>‡∏ä‡∏±‡πâ‡∏ô 9 ‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏ù‡πà‡∏≤‡∏¢‡∏¢‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå ‡πÄ‡∏ß‡∏•‡∏≤ 8.00 ‡∏ô.</li>
            <li>‡πÄ‡∏ß‡∏•‡∏≤‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô 8.00 ‡∏ñ‡∏∂‡∏á 16.00 ‡∏ô. ‡πÇ‡∏î‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏ö‡∏£‡∏¥‡∏ö‡∏≤‡∏•‡πÄ‡∏ä‡πâ‡∏≤-‡πÄ‡∏¢‡πá‡∏ô</li>
            <li>‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô ‡πÉ‡∏´‡πâ‡∏ô‡∏¥‡∏™‡∏¥‡∏ï‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£‡∏ó‡∏µ‡πà‡∏ô‡∏¥‡∏™‡∏¥‡∏ï‡∏ù‡∏∂‡∏Å‡πÉ‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÉ‡∏ö‡∏•‡∏≤‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</li>
            <li>‡∏´‡πâ‡∏≤‡∏°‡πÑ‡∏•‡∏ü‡πå‡∏™‡∏î ‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û ‡∏ñ‡πà‡∏≤‡∏¢‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏à‡∏≤‡∏Å‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£</li>
            <li>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏î‡∏£‡∏ñ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏≠‡∏î‡∏£‡∏≠‡∏ö‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• ‡∏´‡∏£‡∏∑‡∏≠</li>
            <li>‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ä‡∏±‡πâ‡∏ô G ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏ö‡∏±‡∏ï‡∏£‡∏à‡∏≠‡∏î‡∏£‡∏ñ ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏à‡∏≠‡∏î‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏•‡∏∞ 1000 ‡∏ö‡∏≤‡∏ó</li>
          </ul>
        </div>

        <div style="margin-top: 20px;">
          <p>üé• ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</p>
          <!-- Changed from Iframe to Link Button -->
          <a href="https://youtu.be/T38iDeeHkrg" target="_blank" class="btn-video">
            ‚ñ∂Ô∏è ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ (YouTube)
          </a>
        </div>
      </div>

    </div>

    <!-- ================== PART 2: DASHBOARD ================== -->
    <div id="tab-dashboard" class="section">
      <div class="card">
        <h3>üë©‚Äç‚öïÔ∏è Dashboard ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏¥‡∏™‡∏¥‡∏ï</h3>
        
        <div class="form-group">
          <label>‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°:</label>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <select id="dash-year" onchange="renderDashboard()">
              <option value="all">‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ ‡∏û.‡∏®.</option>
            </select>
            <select id="dash-level" onchange="renderDashboard()">
              <option value="all">‡∏ó‡∏∏‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ</option>
            </select>
          </div>
        </div>

        <div class="table-responsive">
          <table id="dash-table">
            <thead>
              <tr>
                <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                <th>‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢</th>
                <th>‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</th>
                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
              </tr>
            </thead>
            <tbody>
              <!-- JS will populate rows here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>

  <script>
    // --- Global Variables ---
    let allData = []; // [Year, Level, Uni, Major, Name, Period]
    let submittedNames = []; // List of names/ids who already submitted
    let filteredData = []; 
    let currentUserID = "";

    // --- Init ---
    window.onload = function() {
      document.getElementById('loading').style.display = 'flex';
      google.script.run.withSuccessHandler(onDataLoaded).getSheetData();
    };

    function onDataLoaded(res) {
      allData = res.masterData;
      submittedNames = res.submittedData;
      document.getElementById('loading').style.display = 'none';
      
      // Init Dashboard filters
      initDashboardFilters();
      renderDashboard(); // Initial render
    }

    // --- Tab Switching ---
    function switchTab(tabName) {
      document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
      
      if(tabName === 'report') {
        document.getElementById('tab-report').classList.add('active');
        document.querySelector('.nav-btn:nth-child(1)').classList.add('active');
        // Reset to Login if needed, or keep state
      } else {
        document.getElementById('tab-dashboard').classList.add('active');
        document.querySelector('.nav-btn:nth-child(2)').classList.add('active');
        renderDashboard(); // Refresh dash
      }
    }

    // --- Login Logic ---
    function handleLogin() {
      const id = document.getElementById('login-id').value;
      if(id.length !== 13) {
        document.getElementById('login-error').style.display = 'block';
        return;
      }
      currentUserID = id;
      document.getElementById('login-error').style.display = 'none';
      document.getElementById('step-login').style.display = 'none';
      document.getElementById('step-form').classList.add('active');
      
      // Load initial dropdown (Year)
      populateDropdown('sel-year', 0, allData);
    }

    // --- Cascading Dropdown Logic ---
    function populateDropdown(elementId, colIndex, sourceData) {
      const select = document.getElementById(elementId);
      select.innerHTML = '<option value="">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>';
      select.disabled = false;

      // Get unique values for this column from sourceData
      const uniqueValues = [...new Set(sourceData.map(row => row[colIndex]))].sort();
      
      uniqueValues.forEach(val => {
        const opt = document.createElement('option');
        opt.value = val;
        opt.text = val;
        select.appendChild(opt);
      });
    }

    function filterData(changedLevel) {
      // Logic: Filter `allData` based on current selections
      const year = document.getElementById('sel-year').value;
      const level = document.getElementById('sel-level').value;
      const uni = document.getElementById('sel-uni').value;
      const major = document.getElementById('sel-major').value;

      let currentFiltered = allData;

      if(year) currentFiltered = currentFiltered.filter(r => r[0] == year);
      if(changedLevel === 'year') {
        resetSelects(['sel-level', 'sel-uni', 'sel-major', 'sel-name']);
        if(year) populateDropdown('sel-level', 1, currentFiltered);
        return;
      }

      if(level) currentFiltered = currentFiltered.filter(r => r[1] == level);
      if(changedLevel === 'level') {
        resetSelects(['sel-uni', 'sel-major', 'sel-name']);
        if(level) populateDropdown('sel-uni', 2, currentFiltered);
        return;
      }

      if(uni) currentFiltered = currentFiltered.filter(r => r[2] == uni);
      if(changedLevel === 'uni') {
        resetSelects(['sel-major', 'sel-name']);
        if(uni) populateDropdown('sel-major', 3, currentFiltered);
        return;
      }

      if(major) currentFiltered = currentFiltered.filter(r => r[3] == major);
      if(changedLevel === 'major') {
        resetSelects(['sel-name']);
        if(major) populateDropdown('sel-name', 4, currentFiltered);
        return;
      }
    }

    function resetSelects(ids) {
      ids.forEach(id => {
        const el = document.getElementById(id);
        el.innerHTML = '<option value="">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</option>';
        el.disabled = true;
      });
      document.getElementById('display-period').innerText = '-';
    }

    function displayPeriod() {
      const name = document.getElementById('sel-name').value;
      const year = document.getElementById('sel-year').value;
      // Find row
      const row = allData.find(r => r[4] === name && r[0] == year);
      if(row) {
        document.getElementById('display-period').innerText = row[5]; // Period is at index 5
      }
    }

    // --- Validation & Submission ---
    async function submitData() {
      // 1. Basic Validation
      const requiredIds = ['sel-name', 'date-xray', 'date-vac', 'file-xray', 'file-vac'];
      for(let id of requiredIds) {
        const el = document.getElementById(id);
        if(!el.value) {
          alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
          el.focus();
          return;
        }
      }

      // 2. Date Validation (12 Months)
      const xrayDate = new Date(document.getElementById('date-xray').value);
      const vacDate = new Date(document.getElementById('date-vac').value);
      const today = new Date();
      const oneYearAgo = new Date();
      oneYearAgo.setFullYear(today.getFullYear() - 1);

      if(xrayDate < oneYearAgo || vacDate < oneYearAgo) {
        document.getElementById('health-error').style.display = 'block';
        window.scrollTo(0, document.getElementById('health-error').offsetTop);
        return;
      } else {
        document.getElementById('health-error').style.display = 'none';
      }

      // 3. Prepare File Upload
      document.getElementById('loading').style.display = 'flex';
      
      try {
        const xrayFile = await getFileBase64(document.getElementById('file-xray').files[0]);
        const vacFile = await getFileBase64(document.getElementById('file-vac').files[0]);

        // Get Selected Data info
        const year = document.getElementById('sel-year').value;
        const level = document.getElementById('sel-level').value;
        const uni = document.getElementById('sel-uni').value;
        const major = document.getElementById('sel-major').value;
        const name = document.getElementById('sel-name').value;
        const period = document.getElementById('display-period').innerText;

        const formData = {
          nationalId: currentUserID,
          year: year,
          level: level,
          uni: uni,
          major: major,
          name: name,
          period: period,
          xrayDate: document.getElementById('date-xray').value,
          xrayFile: xrayFile,
          vaccineDate: document.getElementById('date-vac').value,
          vaccineFile: vacFile
        };

        google.script.run.withSuccessHandler(res => {
          document.getElementById('loading').style.display = 'none';
          if(res.success) {
            document.getElementById('step-form').style.display = 'none';
            document.getElementById('step-success').classList.add('active');
          } else {
            alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + res.message);
          }
        }).submitForm(formData);

      } catch (e) {
        document.getElementById('loading').style.display = 'none';
        alert('Error processing files: ' + e);
      }
    }

    function getFileBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve({ name: file.name, type: file.type, data: reader.result });
        reader.onerror = error => reject(error);
      });
    }

    // --- Dashboard Logic ---
    function initDashboardFilters() {
      // Populate Year and Level filters based on available data
      const years = [...new Set(allData.map(r => r[0]))].sort();
      const levels = [...new Set(allData.map(r => r[1]))].sort();

      const yearSel = document.getElementById('dash-year');
      years.forEach(y => yearSel.innerHTML += `<option value="${y}">${y}</option>`);

      const levelSel = document.getElementById('dash-level');
      levels.forEach(l => levelSel.innerHTML += `<option value="${l}">${l}</option>`);
    }

    function renderDashboard() {
      const yearFilter = document.getElementById('dash-year').value;
      const levelFilter = document.getElementById('dash-level').value;
      const tbody = document.querySelector('#dash-table tbody');
      tbody.innerHTML = '';

      // Filter Data
      let list = allData;
      if(yearFilter !== 'all') list = list.filter(r => r[0] == yearFilter);
      if(levelFilter !== 'all') list = list.filter(r => r[1] == levelFilter);

      list.forEach(row => {
        // row indexes: 0:Year, 1:Level, 2:Uni, 3:Major, 4:Name, 5:Period
        const name = row[4];
        
        // Check submission status
        // Compare Name (row[4]) with submittedNames list
        // Note: Ideally compare by ID, but master data sheet usually doesn't have ID public.
        // Assuming Name is unique or combining checks.
        const isSubmitted = submittedNames.some(sub => sub.name === name);

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>
            <div style="font-weight:bold;">${name}</div>
            <div style="font-size:12px; color:#888;">${row[3]} (‡∏õ‡∏µ ${row[1]})</div>
          </td>
          <td>${row[2]}</td>
          <td>${row[5]}</td>
          <td>
            ${isSubmitted 
              ? '<span class="status-badge status-done">‚úî ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏•‡πâ‡∏ß</span>' 
              : '<span class="status-badge status-pending">‡∏£‡∏≠‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ï‡∏±‡∏ß</span>'}
          </td>
        `;
        // Highlight row if submitted
        if(isSubmitted) tr.style.backgroundColor = "#f0fdf4";
        
        tbody.appendChild(tr);
      });
    }

  </script>
</body>
</html>
